# obos 用户场景与工作流设计方案

> Agent B (Workflow Designer) 交付物
> 核心原则：删繁就简，复杂逻辑后端化，保持用户端简单易用

---

## 一、用户场景地图

### 1.1 晨间规划

**典型流程**：用户打开 Obsidian → 创建/打开今日笔记 → 回顾昨日未完成事项 → 制定今日计划

**当前命令覆盖**：`/obos daily`

**覆盖度**：⬛⬛⬛⬜⬜ 60%

**痛点分析**：

| 痛点 | 说明 |
|------|------|
| 无昨日回顾 | `daily` 仅创建空模板，不会自动拉取昨日未完成项 |
| Plan 区过于简陋 | 只有一个空列表，缺少时间块、优先级等结构 |
| 无 carry-forward | 昨日 Log 中标记为未完成的事项不会自动迁移到今日 Plan |
| 缺少上下文 | 不展示本周目标、近期活跃项目等背景信息 |

**理想流程**：`/obos daily` → 自动创建今日笔记，同时拉取昨日未完成项填入 Plan，展示本周关键目标提醒。

---

### 1.2 会议后记录

**典型流程**：会议结束 → 快速记录要点和行动项 → 关联到相关项目/人物笔记 → 提取待办事项

**当前命令覆盖**：`/obos save` (勉强可用)

**覆盖度**：⬛⬛⬜⬜⬜ 40%

**痛点分析**：

| 痛点 | 说明 |
|------|------|
| 无会议专用模板 | `save` 的三种类型（evergreen/daily/clip）均不适合会议记录 |
| 无行动项提取 | 记录后无法自动识别和提取 action items |
| 无人物/项目关联 | 不能自动建立与参会人、项目笔记的 wikilink |
| 追加到 daily 不够结构化 | `save daily` 只是追加文本，缺少会议元数据（时间、参会人、主题） |

**理想流程**：与 Claude 对话整理会议内容 → `/obos save meeting` → 自动生成结构化会议记录，追加到今日笔记的专属区域，同时提取 action items。

---

### 1.3 周末回顾

**典型流程**：回顾本周所有日记 → 提炼收获与洞察 → 识别模式 → 规划下周方向

**当前命令覆盖**：`/obos weekly`

**覆盖度**：⬛⬛⬛⬛⬜ 80%

**痛点分析**：

| 痛点 | 说明 |
|------|------|
| 输出格式固定 | Highlights/Insights/Patterns/Carry Forward 结构不可定制 |
| 缺少量化指标 | 无完成率、笔记产出量等数据统计 |
| 无跨周趋势 | 只看本周，不对比历史周报 |
| 无交互式回顾 | 一次性生成，用户无法在生成过程中补充或修正 |

**理想流程**：`/obos weekly` → 展示本周概览 → 用户可交互式补充遗漏 → 生成最终周报并自动归档。

---

### 1.4 灵感捕获

**典型流程**：突发灵感/想法 → 快速记录 → 初步分类 → 后续深化

**当前命令覆盖**：`/obos save`

**覆盖度**：⬛⬛⬜⬜⬜ 40%

**痛点分析**：

| 痛点 | 说明 |
|------|------|
| 启动成本高 | 需要先与 Claude 对话，再 save，对于一闪而过的灵感太慢 |
| 类型选择犹豫 | evergreen vs daily 的选择增加认知负担 |
| 缺少快速入口 | 没有"随手记"式的轻量命令 |
| 无自动关联 | 不会自动发现与已有笔记的潜在联系 |

**理想流程**：`/obos quick "灵感内容"` → 自动判断归类 → 存入合适位置 → 提示可能相关的已有笔记。

---

### 1.5 研究与阅读笔记

**典型流程**：阅读文章/书籍 → 摘录重点 → 用自己的话重述 → 建立与已有知识的联系 → 存档

**当前命令覆盖**：`/obos save clip` + `/obos save evergreen`

**覆盖度**：⬛⬛⬛⬜⬜ 60%

**痛点分析**：

| 痛点 | 说明 |
|------|------|
| clip 和 evergreen 割裂 | 从摘录到自己的笔记需要两步操作，且无关联 |
| 无来源管理 | clip 不自动记录来源 URL、作者、日期等元数据 |
| 无渐进式处理 | 一次性保存，缺少"先粗存、后精炼"的工作流 |
| References/ 目录未被利用 | 现有命令不涉及 References/ 目录的管理 |

**理想流程**：`/obos clip "URL"` → 自动抓取并摘录 → `/obos refine` → 从摘录中提炼 evergreen note → 自动建立双向链接。

---

### 1.6 知识检索

**典型流程**：需要某个知识点 → 搜索笔记库 → 找到相关笔记 → 综合多条笔记得出答案

**当前命令覆盖**：无专用命令

**覆盖度**：⬜⬜⬜⬜⬜ 0%

**痛点分析**：

| 痛点 | 说明 |
|------|------|
| 完全空白 | 没有任何命令支持知识检索 |
| 依赖 Obsidian 原生搜索 | Claude 无法利用笔记库内容回答问题 |
| Index.md 利用不足 | sync 生成的索引未被用于智能检索 |

**理想流程**：`/obos ask "问题"` → 搜索笔记库 → 综合相关笔记 → 给出带引用的回答。

---

### 1.7 基于笔记的内容创作

**典型流程**：确定创作主题 → 检索相关笔记 → 组织大纲 → 基于笔记素材撰写 → 输出成文

**当前命令覆盖**：无专用命令

**覆盖度**：⬜⬜⬜⬜⬜ 0%

**痛点分析**：

| 痛点 | 说明 |
|------|------|
| 无素材聚合 | 不能按主题自动收集相关笔记 |
| 无大纲生成 | 不能基于已有笔记自动生成写作大纲 |
| 笔记到成文断层 | 从零散笔记到完整文章缺少桥梁 |

**理想流程**：`/obos draft "主题"` → 自动检索相关笔记 → 生成大纲 → 用户确认后撰写初稿。

---

### 1.8 知识库维护

**典型流程**：定期检查 → 清理孤立笔记 → 补充缺失链接 → 更新索引 → 归档过时内容

**当前命令覆盖**：`/obos sync`

**覆盖度**：⬛⬛⬜⬜⬜ 40%

**痛点分析**：

| 痛点 | 说明 |
|------|------|
| sync 功能单一 | 只更新 Index.md 和 CLAUDE.md，不做健康检查 |
| 无孤立笔记检测 | 不识别没有任何链接的"孤岛"笔记 |
| 无断链检测 | 不检查 wikilink 指向不存在的笔记 |
| 无重复检测 | 不识别内容高度相似的笔记 |
| 无归档建议 | 不提示长期未更新的笔记 |

**理想流程**：`/obos sync` → 更新索引 + 健康报告（孤立笔记、断链、建议合并项）。

---

### 场景覆盖度总览

| 场景 | 当前覆盖 | 核心缺口 |
|------|----------|----------|
| 晨间规划 | 60% | 无 carry-forward，无上下文 |
| 会议后记录 | 40% | 无专用模板，无行动项提取 |
| 周末回顾 | 80% | 格式固定，无跨周趋势 |
| 灵感捕获 | 40% | 启动成本高，无快速入口 |
| 研究与阅读 | 60% | clip/evergreen 割裂，无来源管理 |
| 知识检索 | 0% | 完全空白 |
| 内容创作 | 0% | 完全空白 |
| 知识库维护 | 40% | 仅索引更新，无健康检查 |

---

## 二、现有命令优化方案

### 2.1 /obos init

**当前行为**：创建目录结构（Daily/, Notes/, Clippings/, References/, Attachments/, Categories/, Templates/），生成 CLAUDE.md 和 Index.md。

**优化建议**：

| 维度 | 当前 | 建议 |
|------|------|------|
| 幂等性 | 未知 | 重复执行应安全：已存在的目录/文件跳过，缺失的补建，给出差异报告 |
| 模板初始化 | 生成固定模板 | 同时生成 Templates/Weekly.md、Templates/Meeting.md 等扩展模板 |
| 交互引导 | 无 | 首次 init 时询问用户 vault 主题、关注领域，写入 CLAUDE.md 的 Key Topics |
| 输出反馈 | 未知 | 用 checklist 格式展示创建结果：✓ 已创建 / ○ 已存在跳过 |

**优化后示例**：

```
> /obos init

✓ Daily/          已创建
✓ Notes/          已创建
○ Clippings/      已存在，跳过
✓ Templates/      已创建（含 Daily, Evergreen, Weekly, Meeting 模板）
✓ CLAUDE.md       已生成
✓ Index.md        已生成

Vault 初始化完成。建议运行 /obos daily 开始今天的笔记。
```

---

### 2.2 /obos daily

**当前行为**：基于 Templates/Daily.md 创建今日笔记（Plan/Log/Thoughts 三区），如已存在则打开。

**优化建议**：

| 维度 | 当前 | 建议 |
|------|------|------|
| Carry-forward | 无 | 自动扫描昨日笔记，将未完成的 `- [ ]` 项迁移到今日 Plan |
| 上下文注入 | 无 | 在笔记顶部插入"本周焦点"提醒（从最近周报的 Carry Forward 提取） |
| 模板丰富度 | Plan/Log/Thoughts | 增加 `## Meetings` 区域，供 save meeting 追加 |
| 已存在处理 | 打开 | 打开并报告今日笔记状态（已记录 N 条 log，N 个待办未完成） |
| 日期参数 | 无 | 支持 `/obos daily yesterday` 或 `/obos daily 2026-02-05` 补记历史日记 |

**优化后示例**：

```
> /obos daily

✓ 已创建 Daily/2026-02-08.md
  ↳ 从昨日迁移 2 条未完成待办
  ↳ 本周焦点：完成 obos 插件设计方案

> /obos daily yesterday
✓ 已打开 Daily/2026-02-07.md（已有内容，追加模式）
```

---

### 2.3 /obos weekly

**当前行为**：读取本周 Daily/ 笔记，生成包含 Highlights/Insights/Patterns/Carry Forward/Daily Summary Table 的周报。

**优化建议**：

| 维度 | 当前 | 建议 |
|------|------|------|
| 量化统计 | 无 | 增加完成率（已完成/总待办）、笔记产出数、新建链接数 |
| 周期灵活 | 仅本周 | 支持 `/obos weekly last` 生成上周回顾，`/obos weekly 2026-W05` 指定周 |
| 趋势对比 | 无 | 若存在上周周报，自动附加简要对比（产出量变化、持续关注主题） |
| 存储位置 | 未明确 | 统一存入 `Daily/YYYY-WNN-review.md`，便于后续检索 |
| 输出格式 | 固定 | Carry Forward 区自动生成可勾选的 `- [ ]` 列表，便于下周跟踪 |

**优化后示例**：

```
> /obos weekly

✓ 已生成 Daily/2026-W06-review.md

本周概览：
  📊 待办完成率：12/15 (80%)
  📝 新增笔记：6 篇
  🔗 新建链接：14 条
  📈 vs 上周：笔记 +2，完成率 +5%

Carry Forward → 3 项已写入下周待跟踪
```

---

### 2.4 /obos save

**当前行为**：将对话内容保存为笔记，支持三种类型：evergreen（Notes/）、daily（追加到 Daily/）、clip（Clippings/）。类型可省略，自动检测。

**优化建议**：

| 维度 | 当前 | 建议 |
|------|------|------|
| 类型扩展 | 3 种 | 增加 `meeting` 类型，结构化保存会议记录 |
| 自动标题 | 未知 | evergreen 类型自动生成描述性标题（名词短语），用户可覆盖 |
| 关联发现 | 无 | 保存后自动扫描已有笔记，提示可能相关的 `[[wikilinks]]` |
| 元数据 | 无 | clip 类型自动附加来源信息（URL、日期）；meeting 附加时间、参会人 |
| 确认机制 | 未知 | 保存前展示预览摘要（标题、目标路径、类型），用户确认后写入 |
| 冲突处理 | 未知 | 同名文件存在时提示：覆盖 / 追加 / 重命名 |

**优化后示例**：

```
> /obos save

检测到内容类型：evergreen
  标题：分布式系统中的最终一致性
  路径：Notes/分布式系统中的最终一致性.md
  关联：[[CAP定理]], [[事件溯源]]（已有笔记）

确认保存？(Y/n)
✓ 已保存，自动添加 2 条 wikilink
```

---

### 2.5 /obos sync

**当前行为**：扫描 vault，更新 Index.md（最近 20 篇笔记表格 + 分类 + 统计）和 CLAUDE.md 上下文区域。

**优化建议**：

| 维度 | 当前 | 建议 |
|------|------|------|
| 健康检查 | 无 | 增加孤立笔记、断链、空笔记检测 |
| 报告输出 | 静默更新 | 输出结构化同步报告 |
| 增量模式 | 全量扫描 | 记录上次同步时间，仅处理变更文件（大 vault 性能优化） |
| 分类智能化 | 基于目录 | 基于内容和链接关系自动建议分类调整 |
| 建议行动 | 无 | 输出可操作建议（"3 篇孤立笔记建议添加链接"） |

**优化后示例**：

```
> /obos sync

✓ Index.md 已更新（+3 篇新笔记）
✓ CLAUDE.md 上下文已刷新

健康报告：
  ⚠ 孤立笔记：3 篇（无任何入链或出链）
    → Notes/量子计算基础.md
    → Notes/Rust生命周期.md
    → Clippings/AI芯片趋势.md
  ⚠ 断链：2 处（指向不存在的笔记）
    → [[微服务架构]] 在 Notes/系统设计.md 中
    → [[读书清单]] 在 Daily/2026-02-01.md 中
  ✓ 无重复笔记检测到

建议：运行 /obos save evergreen 为断链创建对应笔记
```

---

## 三、新子命令设计

基于场景地图中识别的覆盖缺口，设计以下新子命令。

### 3.1 /obos quick — 快速捕获

**解决场景**：灵感捕获（1.4）

**语法**：`/obos quick "内容"` 或 `/obos quick`（无参数则从当前对话提取）

**参数**：

| 参数 | 必填 | 说明 |
|------|------|------|
| 内容文本 | 否 | 引号包裹的快速笔记内容；省略则从对话上下文提取 |

**行为**：
1. 接收内容（直接文本或对话提取）
2. 自动判断归属：若为独立想法 → Notes/ 作为种子笔记；若为当日碎片 → 追加到今日 Daily
3. 自动生成简短标题
4. 扫描已有笔记，在输出中提示可能相关的链接
5. 写入文件，无需用户确认（快速优先）

**示例**：

```
> /obos quick "也许可以用 CRDT 替代 OT 来实现协同编辑"

✓ 已保存 → Notes/CRDT替代OT实现协同编辑.md
  💡 可能相关：[[协同编辑架构]], [[分布式数据结构]]
```

**设计理念**：最低摩擦。灵感稍纵即逝，一条命令完成捕获，零决策负担。

---

### 3.2 /obos ask — 知识检索

**解决场景**：知识检索（1.6）

**语法**：`/obos ask "问题"`

**参数**：

| 参数 | 必填 | 说明 |
|------|------|------|
| 问题文本 | 是 | 用户想要查询的问题 |

**行为**：
1. 解析问题关键词
2. 搜索 vault 中所有笔记（利用 Index.md 加速定位）
3. 读取相关笔记内容
4. 综合多条笔记，生成带引用的回答
5. 每条引用标注来源笔记的 `[[wikilink]]`

**示例**：

```
> /obos ask "我之前关于微服务拆分有什么笔记？"

基于你的笔记库，找到 3 篇相关笔记：

1. [[微服务边界划分原则]] — 按业务能力而非技术层拆分，
   强调团队自治和数据独立
2. [[DDD与微服务]] — 用限界上下文指导服务边界
3. Daily/2026-01-15.md — 记录了项目中拆分 Order 服务的实践

核心观点：你倾向于 DDD 驱动的拆分策略，重视数据边界。
```

**设计理念**：让笔记库成为可对话的知识库，而非静态文件堆。

---

### 3.3 /obos draft — 基于笔记的内容创作

**解决场景**：内容创作（1.7）

**语法**：`/obos draft "主题"` 或 `/obos draft "主题" --outline`

**参数**：

| 参数 | 必填 | 说明 |
|------|------|------|
| 主题文本 | 是 | 创作主题或标题 |
| --outline | 否 | 仅生成大纲，不撰写正文 |

**行为**：
1. 根据主题搜索 vault 中相关笔记
2. 展示找到的素材笔记列表，用户可增删
3. 生成写作大纲（含每节对应的素材来源）
4. 用户确认大纲后，基于笔记素材撰写初稿
5. 输出到 Notes/ 目录，标题带 `[Draft]` 前缀

**示例**：

```
> /obos draft "微服务架构实践总结"

找到 5 篇相关笔记：
  1. [[微服务边界划分原则]]
  2. [[DDD与微服务]]
  3. [[服务间通信模式]]
  4. [[微服务监控实践]]
  5. Daily/2026-01-15.md（Order 服务拆分记录）

是否调整素材？(回车确认 / 输入编号移除)

生成大纲：
  1. 引言：为什么选择微服务
  2. 服务边界划分（← [[微服务边界划分原则]], [[DDD与微服务]]）
  3. 通信模式选择（← [[服务间通信模式]]）
  4. 可观测性建设（← [[微服务监控实践]]）
  5. 实战案例（← Daily/2026-01-15.md）
  6. 总结与反思

确认大纲？(Y/n)
✓ 初稿已保存 → Notes/[Draft] 微服务架构实践总结.md
```

**设计理念**：笔记的终极价值在于产出。从积累到创作，打通最后一公里。

---

### 3.4 /obos link — 智能链接建议

**解决场景**：知识库维护（1.8）、所有涉及笔记关联的场景

**语法**：`/obos link` 或 `/obos link "笔记名"`

**参数**：

| 参数 | 必填 | 说明 |
|------|------|------|
| 笔记名 | 否 | 指定笔记；省略则扫描全库 |

**行为**：
1. 分析笔记内容和已有链接图谱
2. 基于语义相似度发现潜在关联
3. 输出建议链接列表，用户逐条确认
4. 确认后自动在笔记中插入 `[[wikilink]]`

**示例**：

```
> /obos link "CAP定理"

分析 Notes/CAP定理.md，发现 3 条潜在链接：

  1. → [[最终一致性]]  （内容提及一致性模型）
  2. → [[分布式事务]]  （同属分布式系统主题）
  3. → [[Cassandra笔记]] （实践案例）

添加哪些？(输入编号，如 1,3 / all / none)
> all
✓ 已添加 3 条链接到 Notes/CAP定理.md
```

**设计理念**：链接是知识网络的血管。降低手动链接的成本，让知识自然生长。

---

### 3.5 /obos refine — 笔记精炼

**解决场景**：研究与阅读笔记（1.5）、灵感捕获后的深化

**语法**：`/obos refine "笔记名"` 或 `/obos refine`（从对话上下文推断）

**参数**：

| 参数 | 必填 | 说明 |
|------|------|------|
| 笔记名 | 否 | 要精炼的笔记；省略则从对话上下文推断目标 |

**行为**：
1. 读取目标笔记（通常是 clip 或 quick 产生的粗笔记）
2. 与用户对话式讨论：哪些要点最重要？你的理解是什么？
3. 从粗笔记中提炼出一篇符合 Evergreen 模板的精炼笔记
4. 保存到 Notes/，并在原笔记中添加指向精炼版的链接

**示例**：

```
> /obos refine "AI芯片趋势"

读取 Clippings/AI芯片趋势.md...

这篇摘录涵盖 3 个要点：
  1. GPU → 专用 ASIC 的趋势
  2. 存算一体架构的兴起
  3. 芯片设计中的 AI 辅助

你最关注哪个方向？想用自己的话怎么表述？
> 我最关注存算一体，因为它可能从根本上改变冯诺依曼瓶颈

✓ 已生成 → Notes/存算一体架构与冯诺依曼瓶颈.md
  ↳ 已在 Clippings/AI芯片趋势.md 中添加链接
```

**设计理念**：知识的价值在于内化。从"别人说的"到"我理解的"，refine 是这个转化的桥梁。

---

### 3.6 /obos status — 知识库仪表盘

**解决场景**：知识库维护（1.8）、晨间规划（1.1）的上下文需求

**语法**：`/obos status`

**参数**：无

**行为**：
1. 快速扫描 vault 状态
2. 输出仪表盘式概览：笔记总数、本周活跃度、待办完成情况、健康指标
3. 不修改任何文件，纯只读操作

**示例**：

```
> /obos status

📦 Vault: obsidian-best-pract
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
笔记总数：47 篇
  Notes/: 23  Clippings/: 12  Daily/: 10  References/: 2

本周活跃：
  新增：4 篇  修改：7 篇  今日待办：3/5 完成

健康指标：
  🟢 链接密度：正常（平均 2.3 链接/笔记）
  🟡 孤立笔记：3 篇（建议 /obos link）
  🟢 断链：0 处

上次同步：2 小时前
```

**设计理念**：一目了然的全局视图，帮助用户快速了解知识库状态，决定下一步行动。

---

### 新子命令总览

| 命令 | 一句话描述 | 解决场景 |
|------|-----------|----------|
| `/obos quick` | 零摩擦快速捕获 | 灵感捕获 |
| `/obos ask` | 向笔记库提问 | 知识检索 |
| `/obos draft` | 基于笔记撰写初稿 | 内容创作 |
| `/obos link` | 智能链接建议 | 知识库维护 |
| `/obos refine` | 粗笔记精炼为 evergreen | 研究阅读、灵感深化 |
| `/obos status` | 知识库仪表盘 | 全局概览 |

---

## 四、命令组合工作流

以下是典型场景下的多命令串联模式，展示命令之间如何协同工作。

### 4.1 晨间启动工作流

**场景**：每天早上开始工作前的固定流程

```
/obos status          ← 快速了解知识库全貌和昨日状态
    ↓
/obos daily           ← 创建今日笔记，自动拉取昨日未完成项
    ↓
（开始一天的工作）
```

**串联价值**：`status` 提供全局视角，`daily` 聚焦今日行动。两步完成从"了解现状"到"开始行动"的过渡。

**优化机会**：可考虑 `/obos daily` 默认在创建笔记时附带简要 status 摘要，将两步合为一步。

---

### 4.2 会议记录工作流

**场景**：会议结束后整理记录并提取行动项

```
（与 Claude 对话整理会议内容）
    ↓
/obos save meeting    ← 结构化保存会议记录到今日笔记
    ↓
/obos link            ← 为会议中提到的概念建立链接
```

**串联价值**：`save meeting` 完成结构化存储，`link` 将会议内容与已有知识网络连接。会议不再是信息孤岛。

---

### 4.3 研究阅读工作流

**场景**：阅读一篇文章后，从摘录到内化的完整流程

```
（与 Claude 讨论文章内容）
    ↓
/obos save clip       ← 保存原始摘录到 Clippings/
    ↓
（进一步讨论、提问、深入理解）
    ↓
/obos refine          ← 从摘录中提炼 evergreen note
    ↓
/obos link            ← 将新笔记与已有知识网络连接
```

**串联价值**：三步完成从"读到"到"学到"的转化。`clip` 保留原始素材，`refine` 完成内化，`link` 织入知识网络。这是渐进式笔记处理的核心路径。

---

### 4.4 周末回顾工作流

**场景**：周末进行本周回顾，规划下周方向

```
/obos weekly          ← 生成本周回顾，提炼洞察和 carry-forward
    ↓
/obos sync            ← 更新索引，获取健康报告
    ↓
/obos link            ← 处理孤立笔记，补充缺失链接
```

**串联价值**：`weekly` 回顾内容层面，`sync` 检查结构层面，`link` 修复连接层面。三个维度的维护一次完成。

---

### 4.5 灵感捕获 → 深化工作流

**场景**：突发灵感，先快速记录，后续有空时深入展开

```
/obos quick "想法..."  ← 即时捕获，零摩擦
    ↓
（稍后有空时）
    ↓
/obos refine           ← 将种子想法展开为完整笔记
    ↓
/obos link             ← 连接到知识网络
```

**串联价值**：分离"捕获"和"处理"两个阶段。`quick` 确保灵感不丢失，`refine` 在合适的时机深化，避免打断当前工作流。

---

### 4.6 知识产出工作流

**场景**：基于积累的笔记撰写一篇文章或报告

```
/obos ask "主题相关问题"  ← 先检索已有知识，了解素材储备
    ↓
/obos draft "主题"        ← 基于笔记生成大纲和初稿
    ↓
（与 Claude 对话修改完善）
    ↓
/obos save evergreen      ← 将定稿保存为正式笔记
```

**串联价值**：`ask` 做素材盘点，`draft` 完成从素材到成文的跳跃，`save` 归档定稿。整个流程让笔记库从"输入端"走向"输出端"。

---

### 4.7 工作流总览图

```
                    ┌─────────────┐
                    │ /obos init  │  ← 一次性初始化
                    └──────┬──────┘
                           │
         ┌─────────────────┼─────────────────┐
         ▼                 ▼                  ▼
   ┌──────────┐    ┌──────────────┐   ┌────────────┐
   │  输入层   │    │   处理层      │   │   输出层    │
   ├──────────┤    ├──────────────┤   ├────────────┤
   │ daily    │    │ refine       │   │ draft      │
   │ quick    │───▶│ link         │──▶│ ask        │
   │ save     │    │ weekly       │   │ status     │
   └──────────┘    └──────────────┘   └────────────┘
         │                 │                  │
         └─────────────────┼──────────────────┘
                           ▼
                    ┌──────────────┐
                    │  /obos sync  │  ← 持续维护
                    └──────────────┘
```

**命令分层逻辑**：

- **输入层**：将信息从外部世界带入 vault（daily、quick、save）
- **处理层**：在 vault 内部加工和连接信息（refine、link、weekly）
- **输出层**：从 vault 中提取价值（draft、ask、status）
- **维护层**：保持 vault 健康运转（sync）

---

## 五、方法论驱动的设计改进

> 本节基于 Agent A（认识论者）的方法论框架，对上述场景地图、命令优化和新命令设计进行方法论层面的校准与深化。

### 5.1 核心方法论原则回顾

Agent A 提出的知识生命周期五阶段模型：

```
捕获 → 加工 → 连接 → 创造 → 归档与回顾
```

以及 AI 角色的苏格拉底原则：

> AI 不给答案，AI 问好问题。AI 不替你思考，AI 帮你思考得更好。

这两个框架对工作流设计的影响是根本性的——不仅要考虑"用户能做什么"，还要考虑"用户在认知层面经历了什么"。

### 5.2 知识成熟度模型对命令设计的影响

Agent A 指出现有系统缺少 **知识成熟度的显式建模**。信息从进入系统到产生价值，应经历明确的阶段跃迁：

```
种子 (seed) → 幼苗 (seedling) → 常青 (evergreen)
```

**对命令设计的具体影响**：

| 命令 | 原设计 | 方法论校准 |
|------|--------|-----------|
| `/obos quick` | 自动判断归属 Notes/ 或 Daily/ | 统一标记为 `seed` 状态，存入 Notes/ 但带种子标记，不假装是成熟笔记 |
| `/obos save` | 直接存为 evergreen/daily/clip | evergreen 类型需通过加工引导才能获得 evergreen 标记；未经加工的默认为 seedling |
| `/obos refine` | 从粗笔记提炼 evergreen | 精炼过程即为 seed → evergreen 的成熟度跃迁，是系统中最核心的认知活动 |
| `/obos status` | 展示笔记总数 | 增加成熟度分布：seed N 篇 / seedling N 篇 / evergreen N 篇 |

**成熟度标记的实现方式**：在笔记 frontmatter 或首行使用简单标记，如 `status: seed`。用户无需手动管理——命令自动设置初始状态，`refine` 完成后自动升级。

---

### 5.3 苏格拉底原则对命令交互的重塑

Agent A 的核心洞察：**AI 不给答案，AI 问好问题**。这对以下命令的交互模式产生根本性修正：

#### 5.3.1 /obos save 的加工引导（最关键修正）

Agent A 审计中对 save 的评分最低（★★☆☆☆），核心问题是"信息囤积风险"。原设计中 save 是一个"存储"动作，方法论要求它变成一个"存储 + 加工"动作。

**修正后的交互流程**：

```
> /obos save

检测到内容类型：evergreen
  AI 提取的核心观点：分布式系统中最终一致性的权衡

在保存前，请回答以下问题（帮助你内化这个知识）：

  Q1: 用你自己的话，这个观点的核心是什么？
  > 最终一致性本质上是用时间换空间——允许短暂不一致来获得更高可用性

  Q2: 这和你已有的哪些认知相关或冲突？
  > 和我之前写的 CAP 定理笔记直接相关，是 AP 选择的具体实现

✓ 已保存 → Notes/最终一致性是时间换空间的权衡.md
  标题基于你的表述生成（非 AI 原文）
  关联：[[CAP定理]]
  状态：evergreen ✓（已通过加工引导）
```

**关键设计决策**：加工引导是可跳过的（`/obos save --quick`），但跳过时笔记标记为 `seedling` 而非 `evergreen`，提醒用户后续需要精炼。这平衡了"快速保存"和"深度加工"两种需求。

#### 5.3.2 /obos weekly 的反思引导（防止 AI 替代思考）

Agent A 对 weekly 的评价是"理念最佳，但需警惕 AI 替代反思的风险"（★★★★☆）。原设计是 AI 直接生成周报，方法论要求改为 **AI 辅助的用户反思**。

**修正后的交互流程**：

```
> /obos weekly

本周数据概览（AI 提供事实，不做判断）：
  日记：5/7 天  待办完成：12/15  新增笔记：6 篇

AI 引导反思：
  Q1: 本周最有价值的一个收获是什么？
  > 理解了 CRDT 的核心原理

  Q2: 有什么事情下周想做不同的？
  > 减少碎片阅读，集中精力在一个主题上

  Q3: 本周的笔记中，哪些值得进一步深化？
  > CRDT 那篇，还有和同事讨论的架构方案

✓ 已生成 Daily/2026-W06-review.md
  内容基于你的回答组织（非 AI 代写）
  Carry Forward：3 项
```

**与原设计的关键区别**：AI 提供数据和提问，用户提供判断和反思。最终周报的核心内容来自用户的回答，而非 AI 的分析。

#### 5.3.3 /obos refine 的苏格拉底式对话（深化原设计）

原设计中 refine 已包含对话式交互，方法论进一步要求：AI 的提问应遵循认知加工的三个核心操作。

**精细化加工三问模型**：

| 步骤 | AI 提问 | 认知活动 |
|------|---------|----------|
| 复述 | "用你自己的话，这个观点的核心是什么？" | Elaboration（精细化） |
| 评判 | "你同意吗？有什么保留意见？" | Critical Thinking（批判性思考） |
| 关联 | "这和你已有的哪些知识相关？" | Association（联想连接） |

refine 生成的 evergreen note 应包含用户对这三个问题的回答，而非 AI 对原文的摘要。这确保 Notes/ 中的每篇笔记都承载了用户的认知加工痕迹。

#### 5.3.4 /obos link 的"建议而非执行"原则

Agent A 明确指出：**连接的价值不在于链接本身，而在于发现连接的认知过程**。原设计中 link 已采用"用户逐条确认"模式，这与方法论一致。

进一步强化：link 在建议链接时，应说明 **为什么** 建议这个链接，而非仅列出候选项。

```
> /obos link "CAP定理"

建议链接：
  1. → [[最终一致性]]
     理由：你在 CAP 笔记中讨论了 AP 选择，最终一致性是 AP 的典型实现
  2. → [[分布式事务]]
     理由：分布式事务是 CP 选择的实现，与 CAP 形成对比视角

添加哪些？(1,2 / all / none)
```

说明理由让用户在确认链接时进行一次微型认知活动——判断这个关联是否成立。

---

### 5.4 Evergreen Note 模板升级

Agent A 指出当前 Evergreen 模板（Summary/Details/Related）缺少 Zettelkasten 方法论中的关键字段。

**当前模板**：
```
# {{title}}
## Summary
## Details
## Related
```

**方法论驱动的升级模板**：
```
# {{title}}

status: {{seed|seedling|evergreen}}
source: {{来源归属}}

## Core Idea（核心观点）
用自己的话，一句话表述

## My Understanding（我的理解）
为什么这个观点重要？我同意/不同意什么？

## Open Questions（开放问题）
这引发了什么新问题？

## Related（关联）
- [[]]
```

**关键变化**：
- `Core Idea` 替代 `Summary`——强调用自己的话表述，而非摘抄
- `My Understanding` 替代 `Details`——强调个人立场和判断
- 新增 `Open Questions`——鼓励持续思考，笔记不是终点
- 新增 `status` 和 `source` 元数据——支持成熟度追踪和来源归属

---

### 5.5 Daily 模板的认知引导升级

Agent A 指出"提示效应"（Prompt Effect）——具体的引导性问题比空白区域更能激发思考。

**当前模板**：
```
# {{date}}
## Plan
-
## Log
-
## Thoughts
```

**方法论驱动的升级模板**：
```
# {{date}}

## Plan
> 今天最重要的一件事是什么？
-

## Log
-

## Thoughts
> 今天学到了什么？改变了什么看法？

## Meetings
```

**关键变化**：
- Plan 和 Thoughts 区增加引导性提问（blockquote 格式，不影响用户书写）
- 新增 Meetings 区，为 `save meeting` 提供追加位置

---

### 5.6 /obos draft 的方法论校准

Agent A 强调"生成效应"（Generation Effect）——主动产出是最强的学习方式。但同时警告 AI 不应代替用户写作，因为"写作本身就是思考"。

**平衡点**：draft 应提供 **框架和素材索引**，而非完整文章。

**修正后的行为**：
1. 检索相关笔记 → 展示素材清单（不变）
2. 生成大纲 → 每节标注素材来源（不变）
3. ~~基于笔记素材撰写初稿~~ → **为每节生成写作提示和关键素材摘要，用户自己写**
4. 用户可选择让 AI 生成某一节的草稿（`--assist` 模式），但默认是用户写

这确保 draft 是"写作辅助工具"而非"代写工具"。用户经历了组织思路和表达的认知过程。

---

### 5.7 init 的"知识管理契约"

Agent A 指出 init 是用户与系统建立关系的第一个接触点，应明确系统哲学。

**修正**：init 完成目录创建后，增加交互式引导：

```
> /obos init

✓ 目录结构已创建
✓ 模板已生成

让我们花一分钟设置你的知识库：

  Q1: 这个知识库的主要用途是什么？
      (a) 工作学习笔记  (b) 个人成长  (c) 研究项目  (d) 综合
  > a

  Q2: 你最关注的 2-3 个领域是什么？
  > 分布式系统、系统设计、Rust

✓ 已写入 CLAUDE.md（AI 将基于这些信息提供更精准的辅助）
```

这不仅填充了 CLAUDE.md 的空白占位符，也让用户在第一次交互时就建立了"这是一个需要我主动参与的系统"的认知。

---

### 5.8 方法论校准总结

以下是方法论框架对各命令设计的核心修正汇总：

| 命令 | 原设计定位 | 方法论校准后定位 | 核心修正 |
|------|-----------|-----------------|----------|
| `init` | 创建目录 | 创建目录 + 建立契约 | 增加交互式引导，填充 CLAUDE.md |
| `daily` | 创建空模板 | 创建引导式模板 | 增加认知引导提问、carry-forward |
| `weekly` | AI 生成周报 | AI 辅助用户反思 | 从"生成"改为"引导反思" |
| `save` | 存储对话内容 | 存储 + 加工引导 | 保存前增加三问引导，区分成熟度 |
| `sync` | 更新索引 | 更新索引 + 健康报告 | 增加知识健康度度量 |
| `quick` | 零摩擦捕获 | 零摩擦捕获（seed 标记） | 明确标记为种子状态 |
| `ask` | 知识检索 | 知识检索（不变） | 方法论无修正，设计已合理 |
| `draft` | AI 撰写初稿 | AI 提供框架，用户写 | 从"代写"改为"辅助写" |
| `link` | 建议链接 | 建议链接 + 说明理由 | 增加理由说明，促进认知判断 |
| `refine` | 对话式精炼 | 苏格拉底式三问精炼 | 结构化为复述→评判→关联三步 |
| `status` | 数量统计 | 数量 + 成熟度分布 | 增加 seed/seedling/evergreen 分布 |

**一句话总结**：方法论校准的核心是将 obos 从"信息存储系统"转变为"认知辅助系统"——每个命令都应包含促进用户思考的环节，而非仅完成机械操作。
