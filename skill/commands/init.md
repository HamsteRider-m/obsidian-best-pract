# /obos init

初始化 Obsidian vault 结构并注册到多 vault 配置。幂等执行，重复运行不会覆盖已有内容。

## Usage

```
/obos init              # 初始化当前目录或默认 vault
/obos init <path>       # 初始化指定路径
```

## Step 1: 确定 Vault 路径

优先级：
1. 命令参数指定的 `<path>`
2. 当前工作目录（如果包含 `.obsidian/`）
3. 用 AskUserQuestion 询问用户 vault 路径

## Step 2: 扫描现有结构

扫描 vault 目录，检测已有目录模式：

| 已有目录 | 建议映射 | 说明 |
|----------|----------|------|
| `Journal/`, `Diary/`, `日记/` | `Inbox/` 或保留 | 建议作为历史内容保留 |
| `Inbox/`, `Fleeting/` | `Inbox/` | 直接复用 |
| `Assets/`, `Images/`, `Media/` | `Attachments/` | 建议重命名 |
| `Sources/`, `Literature/` | `References/` | 建议重命名 |
| `MOC/`, `Maps/`, `Index/` | `Categories/` | 建议重命名 |

如果检测到已有目录，用 AskUserQuestion 询问：
- "重命名为标准名称"
- "保留现有名称"
- "跳过"

**插件冲突检测**：检查 `.obsidian/plugins/` 是否有 Daily Notes 或 Periodic Notes 插件，如有则提示用户注意。

## Step 3: 创建目录（幂等）

标准目录列表（已存在则跳过）：
```
Inbox/          # 收集入口
Notes/          # Evergreen notes
Clippings/      # Web clippings
References/     # Source materials
Attachments/    # Images and files
Categories/     # MOC index pages
Templates/      # Note templates
```

## Step 4: 生成 CLAUDE.md

**已存在 → 跳过，不覆盖。**

不存在则创建：

```markdown
# CLAUDE.md

This file teaches AI assistants about this knowledge vault.

## About This Vault

{{VAULT_PURPOSE}}

## Structure

- `Inbox/` - 收集入口，未整理的想法和笔记
- `Notes/` - Evergreen notes (atomic, linked ideas)
- `Clippings/` - Web clippings and highlights
- `References/` - Source materials (books, articles)
- `Categories/` - MOC (Map of Content) index pages
- `Attachments/` - Images and files

## Conventions

- Note titles: Descriptive, noun phrases
- Links: Use `[[wikilinks]]`
- Tags: Minimal, prefer links over tags

## Key Topics

{{KEY_TOPICS}}

## Active Projects

{{ACTIVE_PROJECTS}}
```

## Step 5: 交互式引导（AskUserQuestion）

填充 CLAUDE.md 占位符：

**Q1 — Vault 用途**：
> "这个 vault 的主要用途是什么？"
> Options: "个人知识管理", "工作项目笔记", "学习与研究", "写作与创作", "混合用途"

**Q2 — 关注领域**：
> "你最关注的 2-3 个领域是什么？"
> 根据 Q1 答案提供示例选项 + "自定义输入"

**Q3 — 活跃项目**（可选）：
> "当前有进行中的项目吗？"
> Options: "有，我来填写", "暂时没有"

用回答替换 CLAUDE.md 中的占位符。

## Step 6: 生成 Index.md

**已存在 → 跳过。**

不存在则创建：

```markdown
# Index

AI-readable index of vault contents. Auto-generated by `/obos sync`.

## Recent Notes

(empty — run `/obos sync` to populate)

## Categories

(empty — run `/obos sync` to populate)

## Statistics

- Total notes: 0
- Last synced: never
```

## Step 7: 创建模板

创建 `Templates/Evergreen.md`（如不存在），使用 SKILL.md 中的 Evergreen Note Template。

## Step 8: 注册 Vault

读取 `obos-config.json`，如果当前 vault 未注册：
1. 用 AskUserQuestion 询问别名："给这个 vault 起个别名（如 personal、work）"
2. 写入配置文件
3. 如果是第一个 vault，自动设为 default

## Output

```
✅ Vault 初始化完成：[vault_path]

目录：
  [✓] Inbox/         — 已创建 | 已存在
  [✓] Notes/         — 已创建 | 已存在
  [✓] Clippings/     — 已创建 | 已存在
  [✓] References/    — 已创建 | 已存在
  [✓] Attachments/   — 已创建 | 已存在
  [✓] Categories/    — 已创建 | 已存在
  [✓] Templates/     — 已创建 | 已存在

文件：
  [✓] CLAUDE.md      — 已生成 | 已存在（未覆盖）
  [✓] Index.md       — 已生成 | 已存在（未覆盖）
  [✓] Templates/Evergreen.md

Vault 已注册为: <alias>

下一步：
  - 运行 /obos save 收集你的第一个想法
  - 运行 /obos tidy 整理已有的散落文件
  - 运行 /obos sync 生成索引
```
